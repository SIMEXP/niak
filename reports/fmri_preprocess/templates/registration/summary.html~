<!DOCTYPE html>
<html>
<head>
  <title>Summary of the fMRI preprocessing pipeline</title>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <link rel="stylesheet" type="text/css" href="assets/bootstrap/bootstrap.min.css" /> <!--from keen.io-->
  <link rel="stylesheet" type="text/css" href="assets/keen/keen-dashboards.css" />    <!--from keen.io-->
  <link rel="stylesheet" type="text/css" href="assets/pretty-json/pretty-json.css" /> <!--from pretty-json-->
  <link href="assets/select2/select2.min.css" rel="stylesheet" /> <!--from select 2-->
  <link href="assets/c3js/c3.min.css" rel="stylesheet" type="text/css"> <!--from c3.js-->
</head>
<body class="application">

  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://niak.simexp-lab.org/pipe_preprocessing.html">fMRI preprocessing pipeline</a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-left">
          <li><a href="summary.html">Summary</a></li>
          <li><a href="registration.html">Registration</a></li>
          <li><a href="motion.html">Motion</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container-fluid">

    <div class="row">
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Pipeline overview
          </div>
          <div class="chart-stage">
            <div id="grid-1-1">
              This report on quality of registration for $N subjects was prepared by $USER, using <a href="http://niak.simexp-lab.org/">NIAK</a> version $NIAK_VERSION on the system $NAME_SYSTEM, on $DATE_TIME. Please read the <a href="http://niak.simexp-lab.org/pipe_preprocessing.html">fMRI preprocessing pipeline</a> for a description of the pipeline parameters described in the middle panel. 
            </div>
          </div>
          <div class="chart-notes">
            
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Summary T1 registration
          </div>
          <div class="chart-stage">
            <div id="chart-T1" style="width:95%"></div>
          </div>
          <div class="chart-notes">
            Click on a bar to open the registration report. Mouse scroll to zoom.
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Summary BOLD registration
          </div>
          <div class="chart-stage">
            <div id="chart-BOLD" style="width:95%"></div>
          </div>
          <div class="chart-notes">
            Click on a bar to open the registration report. Mouse scroll to zoom.
          </div>
        </div>
      </div>
      
<!-- end of three -->

      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
          <div class="chart-title">
            Pipeline options
          </div>
          <div class="chart-stage">
            <div id="elem">
            </div>
          </div>
          <div class="chart-notes">
            Click on {...} to expand.
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
                    <div class="chart-title">
            Input files for subject 
            <select class="js-example-basic-single" style="width: 50%">
              <option value="Subject1">Subject1</option>
              <option value="Subject2">Subject2</option>
            </select>
          </div>
          <div class="chart-stage">
            <div id="elem2">
            </div>
          </div>
          <div class="chart-notes">
            Click on {...} to expand.
          </div>

        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
                    <div class="chart-title">
            Input files for subject 
          </div>
          <div class="chart-stage">
          sdfsdfsdf
          </div>
          <div class="chart-notes">
            Click on {...} to expand.
          </div>

        </div>
      </div>
      <div class="col-sm-6 col-md-4">
        <div class="chart-wrapper">
                    <div class="chart-title">
            Input files for subject 
          </div>
          <div class="chart-stage">
          sdfsdfsdf
          </div>
          <div class="chart-notes">
            Click on {...} to expand.
          </div>

        </div>
      </div>
<!-- end of three -->

    <hr>

    <p class="small text-muted">Built with &#9829; by <a href="http://niak.simexp-lab.org">NIAK</a> using dashboards from <a href="https://keen.io">Keen IO</a></p>

  </div>

  <!--Dependencies-->
  <script src="assets/d3js/d3.min.js" charset="utf-8"></script>
  <script src="assets/c3js/c3.min.js"></script></head>
  <script type="text/javascript" src="assets/jquery/jquery.min.js"></script>       <!--from keen.io-->
  <script type="text/javascript" src="assets/bootstrap/bootstrap.min.js"></script> <!--from keen.io-->
  <script type="text/javascript" src="assets/keen/keen.min.js"></script>           <!--from keen.io-->
  <script type="text/javascript" src="assets/keen/meta.js"></script>               <!--from keen.io-->
  <script type="text/javascript" src="assets/underscore/underscore-min.js"></script>   <!--from pretty-json-->
  <script type="text/javascript" src="assets/backbone/backbone-min.js"></script>       <!--from pretty-json-->
  <script type="text/javascript" src="assets/pretty-json/pretty-json-min.js"></script> <!--from pretty-json-->
  <script src="assets/select2/select2.min.js"></script> <!--from select 2-->
  
  <script>
  $(document).ready(function() {
  $(".js-example-basic-single").select2();
  
  var chart = c3.generate({		 
  bindto: '#chart-T1',		
      data: {		 
      x: 'Subject',		
      columns: [	
          ['Subject','X0010001', 'X0010002'],		 
          ['corr_target',0.67,0.82]		
      ],		
      type: 'bar',		
      onclick: function (d) { selectSubject(d,'chart-T1')}		
  },		
  axis: {		
      x: {		
          type: 'category',		
          }		
      },		
  zoom: {		
      enabled: true		
  },		
  selection: {		
      enabled: true		
  }		
  });		
  $('#chart-T1').data('c3-chart', chart);		
  		
  var chart2 = c3.generate({		
  bindto: '#chart-BOLD',		
  data: {		
    columns: [		
      ['corr_target',0.53,0.62]		
    ],		
    type: 'bar',		
    onclick: function (d) { selectSubject(d,'chart-BOLD')}		
  },		
  axis: {		
      x: {		
          type: 'category',		
          categories: ['X0010002', 'X0010001']		
          }		
      },		
  zoom: {		
      enabled: true		
  },		
  selection: {		
      enabled: true		
  }		
  });		
  $('#chart-BOLD').data('c3-chart', chart2);		
  		
  $(".select-subject").select2();  
 
  function selectSubject (d,type) {		 
    charti = $('#' + type).data('c3-chart');		
    subject = charti.internal.config.axis_x_categories[d.x];		
    var win = window.open(['registration.html?id=' + subject], '_blank');
    if (win) {
      //Browser has allowed it to be opened
      win.focus();
    } else {
      //Browser has blocked it
      alert('Please allow popups for this website'); 
    }
  }
  });
    
  var $eventSelect = $(".js-example-basic-single");
  
  $eventSelect.on("select2:select", function (e) { info(e); })
  
  function info (evt) {
    switch(evt.params.data.id) {
        case "Subject1":
            var filesIn = {
		"anat": "\/home\/pbellec\/demo_niak\/anat_subject1.mnc.gz",
		"fmri": {
			"session1": {
				"motor": "\/home\/pbellec\/demo_niak\/func_motor_subject1.mnc.gz",
				"rest": "\/home\/pbellec\/demo_niak\/func_rest_subject1.mnc.gz"
			}
		}
            };
            break;
        case "Subject2":
            var filesIn = {
		"anat": "\/home\/pbellec\/demo_niak\/anat_subject2.mnc.gz",
		"fmri": {
			"session1": {
				"motor": "\/home\/pbellec\/demo_niak\/func_motor_subject2.mnc.gz",
				"rest": "\/home\/pbellec\/demo_niak\/func_rest_subject2.mnc.gz"
			}
		}
	};
	break;
    };
  
    var node2 = new PrettyJSON.view.Node({
      el:$('#elem2'),
      data: filesIn,
    });
    node2.expandAll();
  }  
  
  var evt = {params:{data:{id:"Subject1"}}};
  info (evt);
  
  var opt = {
	"folder_out": "\/home\/pbellec\/demo_niak\/fmri_preprocess\/",
	"size_output": "quality_control",
	"slice_timing": {
		"type_acquisition": "interleaved ascending",
		"type_scanner": "Bruker",
		"delay_in_tr": 0,
		"suppress_vol": 0,
		"flag_nu_correct": 1,
		"arg_nu_correct": "-distance 200",
		"flag_center": 0,
		"flag_skip": 0
	},
	"motion": {
		"session_ref": "session1"
	},
	"resample_vol": {
		"interpolation": "trilinear",
		"voxel_size": [3,3,3]
	},
	"t1_preprocess": {
		"nu_correct": {
			"arg": "-distance 75"
		}
	},
	"time_filter": {
		"hp": 0.01,
		"lp": "_Inf_"
	},
	"regress_confounds": {
		"flag_wm": 1,
		"flag_vent": 1,
		"flag_motion_params": 1,
		"flag_gsc": 0,
		"flag_scrubbing": 1,
		"thre_fd": 0.5
	},
	"corsica": {
		"sica": {
			"nb_comp": 60
		},
		"threshold": 0.15,
		"flag_skip": 1
	},
	"smooth_vol": {
		"fwhm": 6,
		"flag_skip": 0
	},
	"tune": [
		{
			"subject": "subject1",
			"param": {
				"slice_timing": {
					"flag_center": 1
				}
			}
		},
		{
			"subject": "subject2",
			"param": {
				"slice_timing": {
					"flag_center": 0
				}
			}
		}
	]
    }

var node = new PrettyJSON.view.Node({
  el:$('#elem'),
  data: opt
});
node.collapseAll()

</script>

</body>
</html>
